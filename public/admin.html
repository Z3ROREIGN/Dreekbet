<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin - DreekBet</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="logo">DREEKBET - ADMIN</div>

    <h2>Usuários</h2>
    <div id="usuarios"></div>

    <h2>Apostas</h2>
    <div id="apostas"></div>

    <h2>Resumo Financeiro</h2>
    <div id="resumo"></div>

    <button onclick="logout()" style="margin-top:20px;background:#cc0000;">Sair</button>
  </div>

  <script>
    async function fetchData(url) {
      const res = await fetch(url, { credentials: 'include' });
      if (res.status === 401 || res.status === 403) {
        alert('Acesso negado. Faça login.');
        window.location.href = '/';
        return null;
      }
      return await res.json();
    }

    async function loadUsuarios() {
      const usuarios = await fetchData('/api/admin/usuarios');
      if (!usuarios) return;
      const container = document.getElementById('usuarios');
      container.innerHTML = '';
      usuarios.forEach(u => {
        const div = document.createElement('div');
        div.textContent = `Email: ${u.email} | Saldo: R$ ${u.saldo.toFixed(2)}`;
        container.appendChild(div);
      });
    }

    async function loadApostas() {
      const apostas = await fetchData('/api/admin/apostas');
      if (!apostas) return;
      const container = document.getElementById('apostas');
      container.innerHTML = '';
      apostas.forEach(a => {
        const div = document.createElement('div');
        div.textContent = `Usuário: ${a.userId} | Valor: R$ ${a.valor.toFixed(2)} | Resultado: ${a.resultado}`;
        container.appendChild(div);
      });
    }

    async function loadResumo() {
      const resumo = await fetchData('/api/admin/resumo');
      if (!resumo) return;
      const container = document.getElementById('resumo');
      container.innerHTML = `
        <p>Total Arrecadado: R$ ${resumo.totalArrecadado.toFixed(2)}</p>
        <p>Total Pago em Saques: R$ ${resumo.totalPago.toFixed(2)}</p>
        <p>Saques Pendentes: R$ ${resumo.pendente.toFixed(2)}</p>
      `;
    }

    async function logout() {
      await fetch('/api/logout', { method: 'POST', credentials: 'include' });
      window.location.href = '/';
    }

    async function init() {
      await loadUsuarios();
      await loadApostas();
      await loadResumo();
    }

    window.onload = init;
  </script>
</body>
</html>
